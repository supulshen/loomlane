<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse our complete collection of handcrafted Sri Lankan lifestyle products - traditional wear, home décor, and artisan accessories.">
    <meta name="keywords" content="Sri Lankan products, handcrafted, artisan, traditional wear, home décor, batik">
    <meta name="author" content="Loom & Lane">
    
    <title>Products | Loom & Lane</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* Additional styles for products page - GLASSMORPHISM */
        .filter-sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 80px;
        }
        
        /* Dark mode glassmorphism */
        [data-theme="dark"] .filter-sidebar {
            background: rgba(30, 28, 26, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .filter-section {
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--color-border);
        }
        
        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .filter-section h5 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--spacing-md);
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-xs);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: background var(--transition-fast);
        }
        
        .filter-option:hover {
            background: var(--bg-accent);
        }
        
        .filter-option input[type="checkbox"]:checked + label,
        .filter-option input[type="radio"]:checked + label {
            color: var(--color-accent);
            font-weight: 600;
        }
        
        .filter-option input[type="checkbox"]:checked,
        .filter-option input[type="radio"]:checked {
            accent-color: var(--color-accent);
        }
        
        .filter-option input[type="checkbox"],
        .filter-option input[type="radio"] {
            cursor: pointer;
            margin-right: var(--spacing-xs);
            width: 18px;
            height: 18px;
        }
        
        .filter-option label {
            cursor: pointer;
            margin: 0;
            flex-grow: 1;
        }
        
        .products-header {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .clear-filters-btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        @media (max-width: 991px) {
            .filter-sidebar {
                position: static;
                margin-bottom: var(--spacing-lg);
            }
        }
        
        /* Mobile Filter Drawer */
        @media (max-width: 768px) {
            .filter-sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                width: 85%;
                max-width: 320px;
                height: 100vh;
                z-index: 1050;
                overflow-y: auto;
                transition: left 0.3s ease-in-out;
                padding: var(--spacing-md);
            }
            
            .filter-sidebar.show {
                left: 0;
            }
            
            .filter-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1049;
                opacity: 0;
                transition: opacity 0.3s ease-in-out;
            }
            
            .filter-overlay.show {
                display: block;
                opacity: 1;
            }
            
            .mobile-filter-btn {
                display: block;
                width: 100%;
                margin-bottom: var(--spacing-md);
            }
            
            .desktop-only {
                display: none !important;
            }
            
            .mobile-filter-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: var(--spacing-md);
                padding-bottom: var(--spacing-sm);
                border-bottom: 2px solid var(--color-border);
            }
            
            .mobile-filter-actions {
                display: flex;
                gap: 0.5rem;
                margin-top: var(--spacing-md);
                position: sticky;
                bottom: 0;
                background: var(--bg-secondary);
                padding: var(--spacing-sm) 0;
                border-top: 1px solid var(--color-border);
            }
        }
        
        @media (min-width: 769px) {
            .mobile-filter-btn,
            .mobile-filter-header,
            .mobile-filter-actions {
                display: none !important;
            }
        }
    </style>
</head>
<body>

    <!-- ========== NAVIGATION BAR ========== -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <!-- Logo -->
            <a class="navbar-brand" href="index.html" aria-label="Loom & Lane Home">
                <img src="assets/logo.svg" alt="Loom & Lane Logo" class="logo-dark">
                <img src="assets/logo-light.svg" alt="Loom & Lane Logo" class="logo-light">
            </a>
            
            <!-- Mobile Toggle Button -->
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- Navigation Links -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="products.html" aria-current="page">
                            <i class="fas fa-shopping-bag"></i> Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">
                            <i class="fas fa-info-circle"></i> About
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contact.html">
                            <i class="fas fa-envelope"></i> Contact
                        </a>
                    </li>
                </ul>
                
                <!-- Right Side Icons -->
                <div class="d-flex align-items-center gap-3">
                    <!-- Search Icon -->
                    <button id="searchToggle" class="search-toggle" aria-label="Search products" title="Search">
                        <i class="fas fa-search"></i>
                    </button>
                    
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <!-- Cart Icon with Badge -->
                    <a href="cart.html" class="position-relative cart-icon" aria-label="Shopping cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cartCount" class="cart-badge">0</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Search Overlay -->
    <div id="searchOverlay" class="search-overlay">
        <div class="search-modal">
            <div class="search-header">
                <div class="search-input-wrapper">
                    <i class="fas fa-search search-icon-left"></i>
                    <input 
                        type="text" 
                        id="globalSearch" 
                        class="search-input" 
                        placeholder="Search for products, categories..."
                        autocomplete="off"
                        aria-label="Search products">
                    <button id="searchClose" class="search-close" aria-label="Close search">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="globalSearchResults" class="search-results"></div>
        </div>
    </div>

    <!-- ========== PAGE HEADER ========== -->
    <section class="py-4 page-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 id="pageTitle" class="mb-2">Our Collection</h1>
                    <p class="mb-0">
                        <i class="fas fa-home me-2"></i>
                        <a href="index.html" class="breadcrumb-link">Home</a>
                        <i class="fas fa-chevron-right mx-2" style="font-size: 0.8rem;"></i>
                        <a href="products.html" class="breadcrumb-link">Products</a>
                        <span id="categoryBreadcrumb"></span>
                    </p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <p class="mb-0" id="productCount">
                        <i class="fas fa-box"></i> Loading products...
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== MAIN CONTENT ========== -->
    <section class="py-5">
        <div class="container">
            <!-- Mobile Filter Button -->
            <button class="btn btn-primary mobile-filter-btn" onclick="toggleMobileFilters()">
                <i class="fas fa-sliders-h"></i> Filter Options
            </button>
            
            <!-- Filter Overlay for Mobile -->
            <div class="filter-overlay" onclick="toggleMobileFilters()"></div>
            
            <div class="row">
                <!-- ========== FILTERS SIDEBAR ========== -->
                <div class="col-lg-3">
                    <div class="filter-sidebar">
                        <!-- Mobile Filter Header -->
                        <div class="mobile-filter-header">
                            <h4 class="mb-0">
                                <i class="fas fa-filter"></i> Filters
                            </h4>
                            <button class="btn btn-sm btn-outline" onclick="toggleMobileFilters()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3 desktop-only">
                            <h4 class="mb-0">
                                <i class="fas fa-filter"></i> Filters
                            </h4>
                            <button id="clearFiltersBtn" class="btn btn-sm btn-outline clear-filters-btn" onclick="clearAllFilters()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                        
                        <!-- Category Filter -->
                        <div class="filter-section">
                            <h5><i class="fas fa-tag"></i> Category</h5>
                            <div id="categoryFilters">
                                <!-- Categories will be loaded dynamically -->
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Price Range Filter -->
                        <div class="filter-section">
                            <h5><i class="fas fa-money-bill-wave"></i> Price Range</h5>
                            <div id="priceFilters">
                                <div class="filter-option">
                                    <input type="radio" id="priceAll" name="priceRange" value="all" checked onchange="applyFilters()">
                                    <label for="priceAll">All Prices</label>
                                </div>
                                <div class="filter-option">
                                    <input type="radio" id="price1" name="priceRange" value="0-3000" onchange="applyFilters()">
                                    <label for="price1">Under LKR 3,000</label>
                                </div>
                                <div class="filter-option">
                                    <input type="radio" id="price2" name="priceRange" value="3000-6000" onchange="applyFilters()">
                                    <label for="price2">LKR 3,000 - 6,000</label>
                                </div>
                                <div class="filter-option">
                                    <input type="radio" id="price3" name="priceRange" value="6000-10000" onchange="applyFilters()">
                                    <label for="price3">LKR 6,000 - 10,000</label>
                                </div>
                                <div class="filter-option">
                                    <input type="radio" id="price4" name="priceRange" value="10000-999999" onchange="applyFilters()">
                                    <label for="price4">Above LKR 10,000</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Availability Filter -->
                        <div class="filter-section">
                            <h5><i class="fas fa-check-circle"></i> Availability</h5>
                            <div class="filter-option">
                                <input type="checkbox" id="inStockOnly" onchange="applyFilters()">
                                <label for="inStockOnly">In Stock Only</label>
                            </div>
                        </div>
                        
                        <!-- Mobile Filter Actions -->
                        <div class="mobile-filter-actions">
                            <button class="btn btn-outline flex-grow-1" onclick="clearAllFilters()">
                                <i class="fas fa-redo"></i> Clear All
                            </button>
                            <button class="btn btn-primary flex-grow-1" onclick="toggleMobileFilters()">
                                <i class="fas fa-check"></i> Apply Filters
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ========== PRODUCTS GRID ========== -->
                <div class="col-lg-9">
                    <!-- Products Header with Sorting -->
                    <div class="products-header">
                        <div>
                            <h5 class="mb-0" id="resultsCount">All Products</h5>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <label for="sortSelect" class="mb-0 me-2">
                                <i class="fas fa-sort"></i> Sort by:
                            </label>
                            <select id="sortSelect" class="form-select form-select-sm" style="width: auto; min-width: 200px;" onchange="applySorting()">
                                <option value="newest">Newest First</option>
                                <option value="price-asc">Price: Low to High</option>
                                <option value="price-desc">Price: High to Low</option>
                                <option value="rating">Highest Rated</option>
                                <option value="name">Name: A to Z</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Loading Spinner -->
                    <div id="productsLoading" class="spinner-container" style="min-height: 400px;">
                        <div>
                            <div class="spinner mb-3"></div>
                            <p class="text-muted">Loading products...</p>
                        </div>
                    </div>
                    
                    <!-- Products Grid -->
                    <div id="productsGrid" class="row g-4" style="display: none;">
                        <!-- Products will be loaded dynamically -->
                    </div>
                    
                    <!-- No Results Message -->
                    <div id="noResults" class="text-center py-5" style="display: none;">
                        <i class="fas fa-search fa-4x text-muted mb-3"></i>
                        <h4>No products found</h4>
                        <p class="text-muted">Try adjusting your filters or search criteria</p>
                        <button class="btn btn-primary" onclick="clearAllFilters()">
                            <i class="fas fa-redo"></i> Clear Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== FOOTER ========== -->
    <footer class="footer">
        <div class="container">
            <div class="row g-4">
                <!-- Brand Column -->
                <div class="col-lg-4 col-md-6">
                    <img src="assets/logo.svg" alt="Loom & Lane" class="footer-logo logo-dark">
                    <img src="assets/logo-light.svg" alt="Loom & Lane" class="footer-logo logo-light">
                    <p>Curated Sri Lankan lifestyle products celebrating traditional craftsmanship and sustainable living.</p>
                    <div class="footer-social mt-3">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div class="col-lg-2 col-md-6">
                    <h5>Quick Links</h5>
                    <a href="index.html">Home</a>
                    <a href="products.html">Products</a>
                    <a href="about.html">About Us</a>
                    <a href="contact.html">Contact</a>
                    <a href="cart.html">Shopping Cart</a>
                </div>
                
                <!-- Customer Service -->
                <div class="col-lg-3 col-md-6">
                    <h5>Customer Service</h5>
                    <a href="shipping.html">Shipping Policy</a>
                    <a href="returns.html">Return Policy</a>
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="feedback.html">Feedback</a>
                </div>
                
                <!-- Branch Locations -->
                <div class="col-lg-3 col-md-6">
                    <h5>Our Branches</h5>
                    
                    <div class="branch-card mb-2">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="branch-info">
                            <strong>Colombo</strong>
                            <p class="mb-0">123 Galle Road, Colombo 03</p>
                        </div>
                    </div>
                    
                    <div class="branch-card mb-2">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="branch-info">
                            <strong>Galle</strong>
                            <p class="mb-0">45 Lighthouse Street, Galle Fort</p>
                        </div>
                    </div>
                    
                    <div class="branch-card mb-2">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="branch-info">
                            <strong>Kandy</strong>
                            <p class="mb-0">78 Peradeniya Road, Kandy</p>
                        </div>
                    </div>
                    
                    <div class="branch-card mb-2">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="branch-info">
                            <strong>Kalutara</strong>
                            <p class="mb-0">56 Main Street, Kalutara</p>
                        </div>
                    </div>
                    
                    <div class="branch-card">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="branch-info">
                            <strong>Anuradhapura</strong>
                            <p class="mb-0">89 Sacred City Road, Anuradhapura</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Copyright -->
            <div class="footer-bottom">
                <p class="mb-0">&copy; 2025 Loom & Lane. All rights reserved.</p>
                <p class="mt-2 mb-0" style="font-size: 0.85rem; opacity: 0.8;">
                    <strong>Academic Project:</strong> IT-1308 Web Application Development | 
                    Submitted by: R.A.S.D.Ranasinghe | Student ID: CL/BSCITCS/01/04 | Date: January 2026
                </p>
            </div>
        </div>
    </footer>

    <!-- ========== TOAST CONTAINER ========== -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
        <!-- Toasts will be added here dynamically -->
    </div>

    <!-- ========== SCRIPTS ========== -->
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Custom Scripts -->
    <script src="js/theme.js"></script>
    <script src="js/cart.js"></script>    <script src="js/animations.js"></script>    <script src="js/main.js"></script>
    <script src="js/chatbot.js"></script>
    
    <!-- Products Page Script -->
    <script>
        // ========== PRODUCTS PAGE LOGIC ==========
        
        let allProductsData = [];
        let filteredProducts = [];
        let selectedCategories = [];
        
        /**
         * Create skeleton loading card
         */
        function createSkeletonCard() {
            return `
                <div class="skeleton-card card">
                    <div class="skeleton skeleton-image"></div>
                    <div class="skeleton-content">
                        <div class="skeleton skeleton-title"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text full"></div>
                        <div class="skeleton skeleton-price"></div>
                        <div class="skeleton-buttons">
                            <div class="skeleton skeleton-button"></div>
                            <div class="skeleton skeleton-button"></div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        /**
         * Show skeleton loading cards
         */
        function showSkeletonLoading() {
            const productsGrid = document.getElementById('productsGrid');
            const loadingElement = document.getElementById('productsLoading');
            
            // Hide spinner
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            
            // Show grid with skeleton cards
            if (productsGrid) {
                productsGrid.style.display = 'grid';
                // Generate 8 skeleton cards
                productsGrid.innerHTML = Array(8).fill(null).map(() => createSkeletonCard()).join('');
            }
        }
        
        /**
         * Load products from JSON
         * 
         * IMPORTANT: fetch() requires a local server (e.g., Live Server extension) 
         * due to browser CORS security policies. Opening HTML files directly via 
         * file:// protocol will cause fetch() to fail.
         */
        async function loadProductsData() {
            const loadingElement = document.getElementById('productsLoading');
            
            try {
                // Show skeleton loading instead of spinner
                showSkeletonLoading();
                
                // Simulate realistic loading delay (800ms for demo purposes)
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Fetch products from relative path (requires local server)
                const response = await fetch('data/products.json');
                
                // Check if response is successful
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Parse JSON data
                const data = await response.json();
                
                // Validate data structure
                if (!data.products || !Array.isArray(data.products)) {
                    throw new Error('Invalid data structure');
                }
                
                allProductsData = data.products;
                
                console.log(`✓ Successfully loaded ${allProductsData.length} products`);
                
                // Check for URL parameters BEFORE loading categories
                const urlParams = new URLSearchParams(window.location.search);
                const categoryParam = urlParams.get('category');
                const searchParam = urlParams.get('search');
                
                if (categoryParam) {
                    // Pre-select category from URL
                    selectedCategories = [categoryParam];
                    
                    // Update page title
                    const pageTitle = document.getElementById('pageTitle');
                    if (pageTitle) {
                        pageTitle.textContent = `${categoryParam} Collection`;
                    }
                    
                    // Update breadcrumb
                    const categoryBreadcrumb = document.getElementById('categoryBreadcrumb');
                    if (categoryBreadcrumb) {
                        categoryBreadcrumb.innerHTML = `
                            <i class="fas fa-chevron-right mx-2" style="font-size: 0.8rem;"></i>
                            <span style="color: var(--color-accent); font-weight: 600;">${categoryParam}</span>
                        `;
                    }
                }
                
                if (searchParam) {
                    // Update page title for search
                    const pageTitle = document.getElementById('pageTitle');
                    if (pageTitle) {
                        pageTitle.textContent = `Search: "${searchParam}"`;
                    }
                }
                
                // Load categories (will auto-check based on selectedCategories)
                loadCategoryFilters(data.categories);
                
                // Hide loading spinner
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
                
                // Apply initial filters and display
                applyFilters();
                
                // Scroll to products section if coming from category link
                if (categoryParam) {
                    setTimeout(() => {
                        const productsSection = document.getElementById('productsGrid');
                        if (productsSection) {
                            productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 300);
                }
                
            } catch (error) {
                console.error('❌ Error loading products:', error);
                console.error('Make sure you are running this site with a local server (e.g., Live Server)');
                
                if (loadingElement) {
                    loadingElement.innerHTML = `
                        <div class="text-center text-danger py-5">
                            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                            <h4>Failed to Load Products</h4>
                            <p>Please ensure you are using a local server.</p>
                            <p class="small text-muted">Tip: Install "Live Server" VS Code extension</p>
                        </div>
                    `;
                }
            }
        }
        
        /**
         * Load category filters
         */
        function loadCategoryFilters(categories) {
            const container = document.getElementById('categoryFilters');
            if (!container) return;
            
            let html = '';
            categories.forEach(category => {
                const isChecked = selectedCategories.includes(category.name) ? 'checked' : '';
                html += `
                    <div class="filter-option">
                        <input type="checkbox" id="cat-${category.id}" value="${category.name}" ${isChecked} onchange="handleCategoryChange(this)">
                        <label for="cat-${category.id}">${category.name}</label>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        /**
         * Update page header based on selected categories
         */
        function updatePageHeader() {
            const pageTitle = document.getElementById('pageTitle');
            const categoryBreadcrumb = document.getElementById('categoryBreadcrumb');
            
            if (selectedCategories.length === 0) {
                // No filters - show default
                if (pageTitle) {
                    pageTitle.textContent = 'Our Collection';
                }
                if (categoryBreadcrumb) {
                    categoryBreadcrumb.innerHTML = '';
                }
            } else if (selectedCategories.length === 1) {
                // Single category selected
                const category = selectedCategories[0];
                if (pageTitle) {
                    pageTitle.textContent = `${category} Collection`;
                }
                if (categoryBreadcrumb) {
                    categoryBreadcrumb.innerHTML = `
                        <i class="fas fa-chevron-right mx-2" style="font-size: 0.8rem;"></i>
                        <span style="color: var(--color-accent); font-weight: 600;">${category}</span>
                    `;
                }
            } else {
                // Multiple categories selected
                if (pageTitle) {
                    pageTitle.textContent = 'Filtered Collection';
                }
                if (categoryBreadcrumb) {
                    categoryBreadcrumb.innerHTML = `
                        <i class="fas fa-chevron-right mx-2" style="font-size: 0.8rem;"></i>
                        <span style="color: var(--color-accent); font-weight: 600;">${selectedCategories.length} Categories</span>
                    `;
                }
            }
        }
        
        /**
         * Handle category checkbox change
         */
        function handleCategoryChange(checkbox) {
            const category = checkbox.value;
            
            if (checkbox.checked) {
                if (!selectedCategories.includes(category)) {
                    selectedCategories.push(category);
                }
            } else {
                selectedCategories = selectedCategories.filter(cat => cat !== category);
            }
            
            // Update page header dynamically
            updatePageHeader();
            
            applyFilters();
        }
        
        /**
         * Apply all filters
         */
        function applyFilters() {
            let products = [...allProductsData];
            
            // Filter by category
            if (selectedCategories.length > 0) {
                products = products.filter(product => 
                    selectedCategories.includes(product.category)
                );
            }
            
            // Filter by price range
            const priceRange = document.querySelector('input[name="priceRange"]:checked');
            if (priceRange && priceRange.value !== 'all') {
                const [min, max] = priceRange.value.split('-').map(Number);
                products = products.filter(product => 
                    product.price >= min && product.price <= max
                );
            }
            
            // Filter by availability
            const inStockOnly = document.getElementById('inStockOnly');
            if (inStockOnly && inStockOnly.checked) {
                products = products.filter(product => product.inStock);
            }
            
            filteredProducts = products;
            applySorting();
        }
        
        /**
         * Apply sorting
         */
        function applySorting() {
            const sortSelect = document.getElementById('sortSelect');
            const sortValue = sortSelect ? sortSelect.value : 'newest';
            
            let products = [...filteredProducts];
            
            switch(sortValue) {
                case 'price-asc':
                    products.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    products.sort((a, b) => b.price - a.price);
                    break;
                case 'rating':
                    products.sort((a, b) => b.rating - a.rating);
                    break;
                case 'name':
                    products.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'newest':
                default:
                    products.sort((a, b) => b.id - a.id);
                    break;
            }
            
            displayProducts(products);
        }
        
        /**
         * Display products
         */
        function displayProducts(products) {
            const loadingSpinner = document.getElementById('productsLoading');
            const productsGrid = document.getElementById('productsGrid');
            const noResults = document.getElementById('noResults');
            const resultsCount = document.getElementById('resultsCount');
            const productCount = document.getElementById('productCount');
            
            // Hide loading
            if (loadingSpinner) loadingSpinner.style.display = 'none';
            
            // Update count
            if (productCount) {
                productCount.innerHTML = `<i class="fas fa-box"></i> ${products.length} product${products.length !== 1 ? 's' : ''}`;
            }
            
            if (resultsCount) {
                resultsCount.textContent = `Showing ${products.length} product${products.length !== 1 ? 's' : ''}`;
            }
            
            // Show/hide no results
            if (products.length === 0) {
                if (productsGrid) productsGrid.style.display = 'none';
                if (noResults) noResults.style.display = 'block';
                return;
            }
            
            if (noResults) noResults.style.display = 'none';
            if (productsGrid) productsGrid.style.display = 'flex';
            
            // Display products
            if (productsGrid) {
                productsGrid.innerHTML = products.map(product => createProductCard(product)).join('');
            }
        }
        
        /**
         * Clear all filters
         */
        function clearAllFilters() {
            // Clear category selections
            selectedCategories = [];
            document.querySelectorAll('#categoryFilters input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            
            // Reset price range
            const priceAll = document.getElementById('priceAll');
            if (priceAll) priceAll.checked = true;
            
            // Reset availability
            const inStockOnly = document.getElementById('inStockOnly');
            if (inStockOnly) inStockOnly.checked = false;
            
            // Reset sorting
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) sortSelect.value = 'newest';
            
            // Reset page header to default
            updatePageHeader();
            
            // Reapply filters
            applyFilters();
        }
        
        /**
         * Toggle mobile filter drawer
         */
        function toggleMobileFilters() {
            const sidebar = document.querySelector('.filter-sidebar');
            const overlay = document.querySelector('.filter-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('show');
                overlay.classList.toggle('show');
                
                // Prevent body scroll when filters are open
                if (sidebar.classList.contains('show')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadProductsData();
            updateCartCount();
        });
    </script>
</body>
</html>
